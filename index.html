<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />

  <!-- iOS 全屏 / 主屏幕 WebApp -->
  <meta name="viewport"
        content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Clock">
  <link rel="icon" href="data:,">

  <title>Clock</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    html, body {
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
      touch-action: none;
      -webkit-user-select: none;
      user-select: none;
    }

    body{
      display:flex;
      align-items:center;
      justify-content:center;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
    }

    /* 全屏画布（不做卡片） */
    .clock-container{
      position: relative;
      width: 100%;
      height: 100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      background:#000;
      padding:
        max(env(safe-area-inset-top), 10px)
        max(env(safe-area-inset-right), 10px)
        max(env(safe-area-inset-bottom), 12px)
        max(env(safe-area-inset-left), 10px);
    }

    .time-display{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:0;
      position:relative;
      transform-origin: center center;
    }

    .hours-group, .minutes-group, .seconds-group{
      display:flex;
      align-items:center;
      position:relative;
    }

    :root{
      --digit-w:140px;
      --digit-h:200px;
      --digit-size:200px;
      --overlap:56px;

      /* 挤出速度：越大越慢 */
      --slide-ms: 760ms;
      --slide-ease: cubic-bezier(0.2, 0.9, 0.2, 1);
      --slide-offset: 120%;
    }

    .digit-wrapper, .seconds-wrapper{
      position:relative;
      width:var(--digit-w);
      height:var(--digit-h);
      overflow:visible;
    }

    /* 同组第二位压在第一位上 */
    .hours-group .digit-wrapper + .digit-wrapper,
    .minutes-group .digit-wrapper + .digit-wrapper,
    .seconds-group .seconds-wrapper + .seconds-wrapper{
      margin-left: calc(-1 * var(--overlap));
    }

    /* 冒号：更大、更淡、位置偏中间略下 */
    .colon{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 26px;
      margin: 0 calc(-1 * (var(--overlap) / 2));
      position: relative;
      z-index: 50;
      pointer-events: none;
      transform: translateY(14px);
    }
    .dot{
      width: 34px;
      height: 34px;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      box-shadow: none;
      filter: none;
    }

    /* 倾斜只放容器，稳定不变 */
    #hours-tens   { z-index:10; --rot:-6deg; --skew:-3deg; }
    #hours-ones   { z-index:20; --rot: 4deg; --skew: 2deg; }
    #minutes-tens { z-index:10; --rot:-5deg; --skew:-2deg; }
    #minutes-ones { z-index:20; --rot: 5deg; --skew: 3deg; }
    #seconds-tens { z-index:10; --rot:-4deg; --skew:-2deg; }
    #seconds-ones { z-index:20; --rot: 6deg; --skew: 2deg; }

    #hours-tens, #hours-ones,
    #minutes-tens, #minutes-ones,
    #seconds-tens, #seconds-ones{
      transform: rotate(var(--rot)) skewX(var(--skew));
      transform-origin: 50% 60%;
    }

    /* 两层固定：不增删 DOM，避免闪回 */
    .digit-layer{
      position:absolute;
      inset:0;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      width:100%;
      height:100%;
      will-change: transform, opacity;
      transform: translateY(0);
      opacity:1;
      transition:
        transform var(--slide-ms) var(--slide-ease),
        opacity   var(--slide-ms) var(--slide-ease);
      backface-visibility:hidden;
      transform-style:preserve-3d;
    }

    .digit-text{
      width:100%;
      text-align:center;
      line-height:1;
      font-size:var(--digit-size);

      font-weight: 1000;
      letter-spacing:-10px;
      font-feature-settings:"tnum";
      font-variant-numeric: tabular-nums;

      font-family:
        "SF Pro Rounded",
        "Avenir Next Rounded",
        "Arial Rounded MT Bold",
        "Nunito",
        "Quicksand",
        -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;

      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;

      /* 粗细别靠超大 stroke：控制在合理范围，避免手机糊亮 */
      -webkit-text-stroke: 1.2px currentColor;

      /* 轻微补厚 + 极轻柔化（桌面 ok；手机端会被下面触屏规则关闭） */
      text-shadow: 0 0 0.6px currentColor;
      filter: blur(0.10px);
      opacity: 0.98;
    }

    .deep .digit-text{ color:#0b62c5; }
    .light .digit-text{
      color:#62b7ff;
      opacity:0.90;
      mix-blend-mode: screen;

      /* 桌面：叠亮（手机端会被触屏规则压掉） */
      text-shadow:
        0 0 0.6px currentColor,
        0 0 10px rgba(98,183,255,0.18),
        0 0 22px rgba(98,183,255,0.10);
    }

    /* 初始：第二层在上方隐藏 */
    .off-up{
      transform: translateY(calc(-1 * var(--slide-offset)));
      opacity:0;
    }
    /* 退场：往下挤出 */
    .off-down{
      transform: translateY(var(--slide-offset));
      opacity:0;
    }

    /* 日期（统一圆润风格，偏白，不动画） */
    .date-line{
      margin-top: 22px;
      text-align: center;
      font-size: 20px;
      letter-spacing: 0.06em;
      color: rgba(255,255,255,0.72);

      font-family:
        "SF Pro Rounded",
        "Avenir Next Rounded",
        "Arial Rounded MT",
        "Nunito",
        "Quicksand",
        -apple-system,
        BlinkMacSystemFont,
        "SF Pro Text",
        sans-serif;

      font-weight: 600;
      line-height: 1.2;

      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;

      /* 不要 blur：手机上会糊 */
      filter: none;

      user-select: none;
      pointer-events: none;
    }

    /* 平板/小屏 */
    @media (max-width: 768px){
      .colon{ gap: 18px; transform: translateY(14px); }
      .dot{ width: 24px; height: 24px; background: rgba(255,255,255,0.8); }
      .date-line{ margin-top: 18px; font-size: 16px; letter-spacing: 0.05em; }
    }

    /* 更小屏（宽度断点用于布局比例；质感用触屏规则） */
    @media (max-width: 480px){
      .colon{ gap: 14px; transform: translateY(10px); }
      .dot{ width: 18px; height: 18px; background: rgba(255,255,255,0.8); }
      .date-line{ margin-top: 14px; font-size: 18px; letter-spacing: 0.04em; }
    }

    /* ✅ 触屏设备“质感”规则：横竖屏都生效（解决手机强光晕 + 日期糊） */
    @media (hover: none) and (pointer: coarse){
      .digit-text{
        filter: none !important;
        -webkit-text-stroke: 1.0px currentColor !important;
        text-shadow: 0 0 0.4px currentColor !important;
      }
      .light .digit-text{
        mix-blend-mode: normal !important;      /* 手机不发光 */
        text-shadow: 0 0 0.4px currentColor !important;
        opacity: 0.92 !important;
      }
      .date-line{
        filter: none !important;
        text-rendering: auto !important;
        -webkit-font-smoothing: antialiased !important;
      }
      .dot{ filter: none !important; }
    }
  </style>
</head>

<body>
  <div class="clock-container">
    <div class="time-display">
      <div class="hours-group">
        <div class="digit-wrapper deep"  id="hours-tens"></div>
        <div class="digit-wrapper light" id="hours-ones"></div>
      </div>

      <div class="colon"><div class="dot"></div><div class="dot"></div></div>

      <div class="minutes-group">
        <div class="digit-wrapper deep"  id="minutes-tens"></div>
        <div class="digit-wrapper light" id="minutes-ones"></div>
      </div>

      <div class="colon"><div class="dot"></div><div class="dot"></div></div>

      <div class="seconds-group">
        <div class="seconds-wrapper deep"  id="seconds-tens"></div>
        <div class="seconds-wrapper light" id="seconds-ones"></div>
      </div>
    </div>

    <div class="date-line" id="dateLine"></div>
  </div>

  <script>
    class DigitSlot {
      constructor(hostEl) {
        this.host = hostEl;

        this.front = document.createElement('div');
        this.back  = document.createElement('div');

        this.front.className = 'digit-layer';
        this.back.className  = 'digit-layer off-up';

        this.frontText = document.createElement('div');
        this.backText  = document.createElement('div');
        this.frontText.className = 'digit-text';
        this.backText.className  = 'digit-text';

        this.front.appendChild(this.frontText);
        this.back.appendChild(this.backText);

        this.host.appendChild(this.front);
        this.host.appendChild(this.back);

        this.value = null;
        this.animating = false;

        // transitionend 偶尔会丢：这里正常收尾，另外还有 watchdog 兜底
        this.front.addEventListener('transitionend', (e) => {
          if (e.propertyName !== 'transform') return;
          this.finish();
        });
      }

      finish(){
        if (!this.animating) return;

        const oldFront = this.front;
        const oldFrontText = this.frontText;

        this.front = this.back;
        this.frontText = this.backText;

        this.back = oldFront;
        this.backText = oldFrontText;

        this.back.classList.remove('off-down');
        this.back.classList.add('off-up');
        this.backText.textContent = '';

        this.animating = false;
      }

      setInstant(v) {
        this.value = v;
        this.frontText.textContent = v;
        this.backText.textContent = '';
        this.front.classList.remove('off-down', 'off-up');
        this.back.classList.add('off-up');
        this.animating = false;
      }

      setValue(v) {
        if (v === this.value) return;

        // 如果上一轮没收尾，强制收尾（避免“跑久了动画没了”）
        if (this.animating) this.finish();

        this.value = v;

        // back 放上方，写入新值
        this.backText.textContent = v;
        this.back.classList.add('off-up');
        this.back.classList.remove('off-down');

        // 强制 reflow：保证起始态生效
        void this.back.offsetHeight;

        this.animating = true;

        // 开始动画：front 往下挤出，back 进入
        this.front.classList.add('off-down');
        this.back.classList.remove('off-up');

        // watchdog：transitionend 丢失时也能收尾
        const dur = parseFloat(getComputedStyle(this.front).transitionDuration) * 1000 || 760;
        setTimeout(() => this.finish(), dur + 120);
      }
    }

    const slots = {
      h0: new DigitSlot(document.getElementById('hours-tens')),
      h1: new DigitSlot(document.getElementById('hours-ones')),
      m0: new DigitSlot(document.getElementById('minutes-tens')),
      m1: new DigitSlot(document.getElementById('minutes-ones')),
      s0: new DigitSlot(document.getElementById('seconds-tens')),
      s1: new DigitSlot(document.getElementById('seconds-ones')),
    };

    function updateClock(first = false) {
      const now = new Date();
      const h = String(now.getHours()).padStart(2, '0');
      const m = String(now.getMinutes()).padStart(2, '0');
      const s = String(now.getSeconds()).padStart(2, '0');

      const vals = { h0: h[0], h1: h[1], m0: m[0], m1: m[1], s0: s[0], s1: s[1] };

      if (first) {
        Object.keys(vals).forEach(k => slots[k].setInstant(vals[k]));
      } else {
        Object.keys(vals).forEach(k => slots[k].setValue(vals[k]));
      }
    }

    function updateDate() {
      const now = new Date();
      const weekday = now.toLocaleDateString('en-US', { weekday: 'long' });
      const month   = now.toLocaleDateString('en-US', { month: 'long' });
      const day     = now.getDate();
      const year    = now.getFullYear();
      document.getElementById('dateLine').textContent = `${weekday} · ${month} ${day}, ${year}`;
    }

    // 对齐整秒 + 可重启（解决后台/长时间节流后“动画消失/错拍”）
    let tickTimer = null;

    function scheduleTick(){
      updateClock(false);
      const now = Date.now();
      const delay = 1000 - (now % 1000) + 2;
      tickTimer = setTimeout(scheduleTick, delay);
    }

    function restartTick(){
      if (tickTimer) clearTimeout(tickTimer);
      updateClock(true);
      scheduleTick();
    }

    // 初始化
    updateClock(true);
    updateDate();

    // 每分钟更新一次日期（够用）
    setInterval(updateDate, 60 * 1000);

    restartTick();

    // 从后台/锁屏回来时重启节拍（iPhone 尤其重要）
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) restartTick();
    });
    window.addEventListener('pageshow', restartTick);
  </script>
</body>
</html>



